<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pac-Man Niveaux AlÃ©atoires (Position CorrigÃ©e)</title>
<style>
Â  Â  /* VARIABLES CSS pour faciliter la maintenance */
Â  Â  :root {
Â  Â  Â  Â  --cell-size: 20px; /* Taille de la cellule de grille */
Â  Â  Â  Â  --pacman-size: 18px; /* Taille de Pac-Man */
Â  Â  Â  Â  --center-offset: 1px; /* (20px - 18px) / 2 = 1px */
Â  Â  }
Â  Â Â 
Â  Â  /* Styles de base et du corps */
Â  Â  body {
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  background: #0d0d0d;
Â  Â  Â  Â  font-family: 'Arial', sans-serif;
Â  Â  Â  Â  color: #fff;
Â  Â  }
Â  Â Â 
Â  Â  /* Zone d'information (Score/Niveau) */
Â  Â  #info-bar {
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  text-shadow: 0 0 10px #FFD700;
Â  Â  Â  Â  color: #FFFF00;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  gap: 50px;
Â  Â  }

    /* --- CORRECTION CSS (1/2) --- */
    /* NOUVEAU CONTENEUR pour le jeu ET Pac-Man */
Â  Â  #game-container {
Â  Â  Â  Â  position: relative; /* LA CLÃ‰ EST ICI ! */
Â  Â  Â  Â  width: 400px;
Â  Â  Â  Â  height: 400px;
        /* On dÃ©place les bordures et ombres ici */
Â  Â  Â  Â  border: 4px solid #00FFFF;
Â  Â  Â  Â  box-shadow: 0 0 20px #00FFFF, inset 0 0 10px #00FFFF;
Â  Â  Â  Â  box-sizing: content-box;Â 
Â  Â  }

Â  Â  /* Conteneur du jeu (MODIFIÃ‰) */
Â  Â  #game {
Â  Â  Â  Â  /* position: relative; (n'est plus nÃ©cessaire ici) */
Â  Â  Â  Â  width: 400px;
Â  Â  Â  Â  height: 400px;
Â  Â  Â  Â  background: #000;
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  /* Utilisation de la variable CSS pour la grille */
Â  Â  Â  Â  grid-template-columns: repeat(20, var(--cell-size));
Â  Â  Â  Â  grid-template-rows: repeat(20, var(--cell-size));
        /* --- CORRECTION CSS (2/2) --- */
        /* On retire les styles visuels qui sont maintenant sur le parent */
Â  Â  Â  Â  /* border: 4px solid #00FFFF; */
Â  Â  Â  Â  /* box-shadow: 0 0 20px #00FFFF, inset 0 0 10px #00FFFF; */
Â  Â  Â  Â  /* box-sizing: content-box; */Â 
Â  Â  }
Â  Â Â 
Â  Â  /* Murs ðŸ§± - Ã‰pais et stylisÃ©s */
Â  Â  .wall {
Â  Â  Â  Â  background: #0000AA;
Â  Â  Â  Â  border: 1px solid #0000FF;
Â  Â  Â  Â  box-shadow: inset 0 0 8px #0000FF, 0 0 5px #0000FF;
Â  Â  }

Â  Â  /* Points (Pac-Dots) ðŸŸ¡ - Plus brillants */
Â  Â  .dot-container {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  align-items: center;
Â  Â  }
Â  Â  .dot {
Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  background: #FFFF00;
Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  box-shadow: 0 0 10px #FFFF00, 0 0 20px #FFD700;
Â  Â  Â  Â  animation: pulse 1.5s infinite alternate;
Â  Â  }

Â  Â  /* Pac-Man ðŸ˜‹ - La star du jeu */
Â  Â  #pacman {
Â  Â  Â  Â  position: absolute; /* Se positionne maintenant par rapport Ã  #game-container */
Â  Â  Â  Â  width: var(--pacman-size); /* Utilisation de la variable */
Â  Â  Â  Â  height: var(--pacman-size); /* Utilisation de la variable */
Â  Â  Â  Â  background: #FFD700;
Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  transition: left 0.1s linear, top 0.1s linear, transform 0.1s;
Â  Â  Â  Â  box-shadow: 0 0 15px #FFD700;
Â  Â  Â  Â Â 
Â  Â  Â  Â  clip-path: polygon(100% 0, 100% 50%, 75% 50%, 100% 100%, 0 100%, 0 0);
Â  Â  Â  Â  animation: chomp 0.2s infinite step-end;
Â  Â  Â  Â  transform-origin: center;
Â  Â  }

Â  Â  /* Keyframes pour les animations */
Â  Â  @keyframes chomp {
Â  Â  Â  Â  0% { clip-path: polygon(100% 0, 100% 50%, 75% 50%, 100% 100%, 0 100%, 0 0); }
Â  Â  Â  Â  50% { clip-path: circle(50% at 50% 50%); }
Â  Â  }
Â  Â Â 
Â  Â  @keyframes pulse {
Â  Â  Â  Â  from { opacity: 0.8; transform: scale(1); }
Â  Â  Â  Â  to { opacity: 1; transform: scale(1.1); }
Â  Â  }
</style>
</head>
<body>
<div id="info-bar">
Â  Â  <div id="level-display">Niveau: 1</div>
Â  Â  <div id="score-display">Score: 0</div>
</div>

<div id="game-container">
    <div id="game"></div>
    <div id="pacman"></div>
</div>
<script>
Â  Â  const game = document.getElementById('game');
Â  Â  const pacman = document.getElementById('pacman');
Â  Â  const levelDisplay = document.getElementById('level-display');
Â  Â  const scoreDisplay = document.getElementById('score-display');

Â  Â  // RÃ©cupÃ©rer les valeurs du CSS pour un calcul exact
Â  Â  const size = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--cell-size')); // 20
Â  Â  const pacmanSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--pacman-size')); // 18
Â  Â  const offset = (size - pacmanSize) / 2; // 1

Â  Â  const gridCols = 20;
Â  Â  const gridRows = 20;
Â  Â Â 
Â  Â  let grid = [];
Â  Â  let maze = [];
Â  Â  let pac = {row:1, col:1, direction: 'right'};
Â  Â  let currentLevel = 1;
Â  Â  let score = 0;
Â  Â  let dotsRemaining = 0;

Â  Â  // --- 1. Logique de Progression de Niveau ---

Â  Â  function nextLevel() {
Â  Â  Â  Â  currentLevel++;
Â  Â  Â  Â  levelDisplay.textContent = `Niveau: ${currentLevel}`;
Â  Â  Â  Â  initGame();
Â  Â  }

Â  Â  function checkWinCondition() {
Â  Â  Â  Â  if (dotsRemaining === 0) {
Â  Â  Â  Â  Â  Â  setTimeout(nextLevel, 500);
Â  Â  Â  Â  }
Â  Â  }


Â  Â  // --- 2. GÃ©nÃ©ration AlÃ©atoire du Labyrinthe (DFS) ---
Â  Â  function createEmptyMaze() {
Â  Â  Â  Â  const tempMaze = [];
Â  Â  Â  Â  for (let r = 0; r < gridRows; r++) {
Â  Â  Â  Â  Â  Â  tempMaze[r] = [];
Â  Â  Â  Â  Â  Â  for (let c = 0; c < gridCols; c++) {
Â  Â  Â  Â  Â  Â  Â  Â  tempMaze[r][c] = 1;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  return tempMaze;
Â  Â  }

Â  Â  function generateRandomMaze() {
Â  Â  Â  Â  maze = createEmptyMaze();
Â  Â  Â  Â  const stack = [];
Â  Â  Â  Â  const startR = 1;
Â  Â  Â  Â  const startC = 1;
Â  Â  Â  Â Â 
Â  Â  Â  Â  stack.push({ r: startR, c: startC });
Â  Â  Â  Â  maze[startR][startC] = 0;

Â  Â  Â  Â  while (stack.length > 0) {
Â  Â  Â  Â  Â  Â  const current = stack.pop();
Â  Â  Â  Â  Â  Â  const { r, c } = current;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const directions = [
Â  Â  Â  Â  Â  Â  Â  Â  { dr: -2, dc: 0 }, { dr: 2, dc: 0 },Â 
Â  Â  Â  Â  Â  Â  Â  Â  { dr: 0, dc: -2 }, { dr: 0, dc: 2 }
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  directions.sort(() => Math.random() - 0.5);

Â  Â  Â  Â  Â  Â  for (const dir of directions) {
Â  Â  Â  Â  Â  Â  Â  Â  const nextR = r + dir.dr;
Â  Â  Â  Â  Â  Â  Â  Â  const nextC = c + dir.dc;

Â  Â  Â  Â  Â  Â  Â  Â  if (nextR > 0 && nextR < gridRows - 1 && nextC > 0 && nextC < gridCols - 1 && maze[nextR][nextC] === 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const wallR = r + dir.dr / 2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const wallC = c + dir.dc / 2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maze[wallR][wallC] = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maze[nextR][nextC] = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stack.push(current);Ã‚ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stack.push({ r: nextR, c: nextC });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function drawMaze() {
Â  Â  Â  Â  game.innerHTML = ''; // C'est OK car Pac-Man n'est plus un enfant de #game
Â  Â  Â  Â  grid.length = 0;
Â  Â  Â  Â  dotsRemaining = 0;

Â  Â  Â  Â  for(let r=0;r<gridRows;r++){
Â  Â  Â  Â  Â  Â  for(let c=0;c<gridCols;c++){
Â  Â  Â  Â  Â  Â  Â  Â  if(maze[r][c] === 0){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maze[r][c] = 2;Ã‚ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dotsRemaining++;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Ã‚ 
Â  Â  Â  Â  maze[pac.row][pac.col] = 0;
Â  Â  Â  Â  dotsRemaining--;

Â  Â  Â  Â  for(let r=0;r<gridRows;r++){
Â  Â  Â  Â  Â  Â  for(let c=0;c<gridCols;c++){
Â  Â  Â  Â  Â  Â  Â  Â  const cell = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  if(maze[r][c]===1) cell.className='wall';
Â  Â  Â  Â  Â  Â  Â  Â  else if(maze[r][c]===2){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cell.className='dot-container';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dot = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.className='dot';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cell.appendChild(dot);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  game.appendChild(cell);
Â  Â  Â  Â  Â  Â  Â  Â  grid.push({row:r,col:c,type:maze[r][c],el:cell});
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- 3. ContrÃ´les et Mouvement (avec Correction de Position Fiable) ---

Â  Â  function updatePacmanPosition() {
        /* Ce code est maintenant correct car #pacman est positionnÃ©
           par rapport Ã  #game-container, qui est alignÃ© avec #game */
Â  Â  Â  Â  pacman.style.left = (pac.col * size + offset) + 'px';Ã‚ 
Â  Â  Â  Â  pacman.style.top = (pac.row * size + offset) + 'px';
Â  Â  }

Â  Â  function setPacmanRotation(dir) {
Â  Â  Â  Â  let rotation = 0;
Â  Â  Â  Â  if (dir === 'right') rotation = 0;
Â  Â  Â  Â  else if (dir === 'down') rotation = 90;
Â  Â  Â  Â  else if (dir === 'left') rotation = 180;
Â  Â  Â  Â  else if (dir === 'up') rotation = 270;

Â  Â  Â  Â  pacman.style.transform = `rotate(${rotation}deg)`;
Â  Â  }
Â  Â Ã‚ 
Â  Â  let isListenerActive = false;Ã‚ 

Â  Â  function handleKeyDown(e) {
Â  Â  Â  Â  let newRow = pac.row;
Â  Â  Â  Â  let newCol = pac.col;
Â  Â  Â  Â  let newDir = pac.direction;

Â  Â  Â  Â  if(e.key==='ArrowUp'){ newRow--; newDir='up'; }
Â  Â  Â  Â  else if(e.key==='ArrowDown'){ newRow++; newDir='down'; }
Â  Â  Â  Â  else if(e.key==='ArrowLeft'){ newCol--; newDir='left'; }
Â  Â  Â  Â  else if(e.key==='ArrowRight'){ newCol++; newDir='right'; }

Â  Â  Â  Â  if (newDir !== pac.direction) {
Â  Â  Â  Â  Â  Â  pac.direction = newDir;
Â  Â  Â  Â  Â  Â  setPacmanRotation(pac.direction);
Â  Â  Â  Â  }

Â  Â  Â  Â  if(newRow>=0 && newRow<gridRows && newCol>=0 && newCol<gridCols && maze[newRow][newCol]!==1){
Â  Â  Â  Â  Â  Â Ã‚ 
Â  Â  Â  Â  Â  Â  pac.row=newRow; pac.col=newCol;
Â  Â  Â  Â  Â  Â  updatePacmanPosition();

Â  Â  Â  Â  Â  Â  const idx = newRow*gridCols+newCol;
Â  Â  Â  Â  Â  Â  if(grid[idx].type===2){
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;Ã‚ 
Â  Â  Â  Â  Â  Â  Â  Â  dotsRemaining--;
Â  Â  Â  Â  Â  Â  Â  Â  scoreDisplay.textContent = `Score: ${score}`;

Â  Â  _ Â  Â  Â  Â  Â  Â  grid[idx].type=0;Ã‚ 
Â  Â  Â  Â  Â  Â  Â  Â  maze[newRow][newCol] = 0;Ã‚ 
Â  Â  Â  Â  Â  Â  Â  Â  grid[idx].el.innerHTML='';Ã‚ 

Â  Â  Â  Â  Â  Â  Â  Â  checkWinCondition();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- 4. Fonction d'Initialisation Globale ---

Â  Â  function initGame() {
Â  Â  Â  Â  // 1. GÃ©nÃ©rer le nouveau labyrinthe et le dessiner
Â  Â  Â  Â  generateRandomMaze();
Â  Â  Â  Â  drawMaze();

Â  Â  Â  Â  // 2. RÃ©initialiser la position et l'apparence de Pac-Man
Â  Â  Â  Â  pac.row = 1;
Â  Â  Â  Â  pac.col = 1;
Â  Â  Â  Â  pac.direction = 'right';
Â  Â  Â  Â  updatePacmanPosition();
Â  Â  Â  Â  setPacmanRotation(pac.direction);
Â  Â  Â  Â Ã‚ 
Â  Â  Â  Â  // 3. Activer les Ã©couteurs si ce n'est pas dÃ©jÃ  fait
Â  Â  Â  Â  if (!isListenerActive) {
Â  Â  Â  Â  Â  Â  document.addEventListener('keydown', handleKeyDown);
Â  Â  Â  Â  Â  Â  isListenerActive = true;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // DÃ©marrer le jeu
Â  Â  initGame();Ã‚ 
</script>
</body>
</html>
